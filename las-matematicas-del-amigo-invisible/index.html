<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    <title>Las matemáticas del amigo invisible</title>
    <meta name="description" content="" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
	
	<link href='http://fonts.googleapis.com/css?family=Cabin+Condensed:700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Noto+Serif:400,400italic,700,700italic' rel='stylesheet' type='text/css'>

    
    <link rel="stylesheet" href="../assets/css/ghostion.min.css?v=4589256930" />

    
    <!-- <link rel="stylesheet" href="/assets/css/ghostion.custom.css?v=4589256930" /> -->

	<script type="text/x-mathjax-config" async defer>MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&locale=es" async defer></script>


    
    <meta name="generator" content="Ghost 0.4" />
<link rel="alternate" type="application/rss+xml" title="Esquelario" href="../rss/index.html">
<link rel="canonical" href="http://esquelario.tk/las-matematicas-del-amigo-invisible/" />
</head>
<body class="post-template tag-matemáticas tag-juego">
    <div id="at_page_surround">
        <div id="at_body">
            


<div class="left-off-canvas-menu">
	<ul class="off-canvas-list">
		<li><label>Menú</label></li>
		<li><a class="at_menu_item" href="http://esquelario.tk"><span class="fa fa-home"></span> Inicio</a></li>
		<li><a class="at_menu_item" href="http://esquelario.tk/rss"><span class="fa fa-rss"></span> Abono</a></li>
		<li><a class="at_menu_item" href="http://esquelario.tk/sobre-el-blog"><span class="fa fa-file-text"></span> Sobre el blog</a></li>
		<li><a class="at_menu_item" href="http://esquelario.tk/licencia"><span class="fa fa-legal"></span> Licencia</a></li>
	</ul>
</div>



<div id="at_header">
    <div class="row">
        <div class="medium-4 columns">
            <div class="at_logo_container">
                
                        <a href="http://esquelario.tk">
                
                    <span class="at_logo_text">Esquelario</span></a>
            </div>
        </div>
        <div class="medium-4 columns text-right hide-for-small-only">
            <div class="at_icon_menu">
				<a class="at_icon_menu_item" href="http://esquelario.tk/rss" data-tooltip class="has-tip" title="Abono"><span class="fa fa-rss"></span></a>
                <a class="at_icon_menu_item" href="http://esquelario.tk/sobre-el-blog" data-tooltip class="has-tip" title="Sobre el blog"><span class="fa fa-file-text"></span></a>
                <a class="at_icon_menu_item" href="http://esquelario.tk/licencia" data-tooltip class="has-tip" title="Licencia"><span class="fa fa-legal"></span></a>
                
            </div>
        </div>
        <div class="medium-4 columns">
            <div id="at_search">
	<div class="row">
		<div class="large-12 large-centered columns">
			<input class="at_search_input" type="text" placeholder="Buscar...">
		</div>
	</div>
	<div class="at_search_results"></div>
</div>

        </div>
    </div>
</div>



<div id="at_showcase">
	<div class="at_blog_cover" style="background-image: url(../content/images/2014/feb./banner_espejo-1.jpg)">
	    <div class="at_showcase_overlay at_with_blog_cover">
			<div class="row">
				<div class="large-12 large-centered columns">
					<div class="at_block">
						<div class="text-center">
				            
				            <div class="at_block">
				                <article class="post tag-matemáticas tag-juego">
				                    <div class="at_post_header">
				                        <h2 class="at_post_title">Las matemáticas del amigo invisible</h2>
				                    </div>
				                    <div class="at_post_meta">
				                        <span class="at_featured_post"><span class="fa fa-bookmark"></span> <span>Destacado</span></span>
				                        <span class="at_post_author"><span class="fa fa-user"></span> Shevek</span>
				                        <time class="at_post_time" datetime="2014-01-04"><span class="fa fa-calendar"></span> 4 de enero de 2014</time>
				                        <span class="at_post_tags"><span class="fa fa-tags"></span> matemáticas, juego</span>
				                    </div>
					                <div class="at_post_share">
					                    <h6 class="at_post_share_title">¡Compártelo!</h6>
					                    <a class="at_post_share_icon" href="http://twitter.com/share?text=Las%20matem%C3%A1ticas%20del%20amigo%20invisible&url=http://esquelario.tk/las-matematicas-del-amigo-invisible/"
					                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
					                        <span class="fa fa-twitter-square"></span>
					                    </a>
					                    <a class="at_post_share_icon" href="https://www.facebook.com/sharer/sharer.php?u=http://esquelario.tk/las-matematicas-del-amigo-invisible/"
					                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
					                        <span class="fa fa-facebook-square"></span>
					                    </a>
					                    <a class="at_post_share_icon" href="https://plus.google.com/share?url=http://esquelario.tk/las-matematicas-del-amigo-invisible/"
					                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
					                        <span class="fa fa-google-plus-square"></span>
					                    </a>
										<a class="at_post_share_icon" href="http://www.meneame.net/submit.php?url=http://esquelario.tk/las-matematicas-del-amigo-invisible/&title=Las matemáticas del amigo invisible" onclick="window.open(this.href, 'meneame-share', 'width=490,height=530');return false;">
					                        <span class="icon-meneame"></span>
					                    </a>
					                </div>
				                </article>
				            </div>
				            
						</div>
					</div>
				</div>
			</div>
	    </div>
	</div>
</div>



<div id="at_mainbody" class="at_post" role="main">
    <div class="row">
        <div class="large-12 columns">
            
            <div class="at_block">
                <article class="post tag-matemáticas tag-juego">
                    <div class="at_post_content">
                        <p>Todos sabemos en qué consiste el juego del <strong>amigo invisible</strong>: es una manera de organizar los regalos entre un grupo de amigos o familares de forma que cada persona hace un solo regalo a otra persona del grupo sin que ésta sepa quién se lo hace. Y, a su vez, recibe un regalo de alguna otra persona del grupo sin conocer su identidad, llamada por tanto <em>amigo invisible</em>. </p>

<p>Al organizar un <em>amigo invisible</em> hay dos características que deben observarse: </p>

<ol>
<li>que sea secreto (nadie debe saber quién es su amigo invisible)  </li>
<li>que, sea cual sea el procedimiento de asignar amigos invisibles, nadie debe ser su propio amigo invisible</li>
</ol>

<p>Desde el punto de vista de la organización de un grupo (digamos, Arturo, Beatriz, Carlos y Diana {A, B, C, D}), podemos hacer una distribución de amigo invisible simplemente creando una <a href="http://es.wikipedia.org/wiki/Permutaci%C3%B3n">permutación</a> aleatoria de ese conjunto y enfrentándola al primero. Por ejemplo, tenemos la permutación {B, D, A, C}:</p>

<pre><code>   A  B  C  D
   B  D  A  C
</code></pre>

<p>Que se puede leer como: Arturo regala a Beatriz, Beatriz a Diana, Carlos a Arturo y Diana a Carlos.</p>

<p>El problema es si esa permutación aleatoria enfrenta a una misma persona, lo que no debe ser posible por la segunda condición expresada más arriba; por ejemplo, la permutación {C, B, D, A} no es válida, puesto que Beatriz sería su propia amiga invisible.</p>

<p>Luego la pregunta es inmediata: ¿cuántas permutaciones del conjunto inicial forman un reparto aceptable para hacer un amigo invisible? Es decir, ¿cuantas permutaciones del conjunto mueven a <em>todos</em> sus elementos de su situación de partida?</p>

<h3 id="anlisisdelproblema">Análisis del problema</h3>

<p>Por tanto el problema se reduce a analizar las permutaciones de un conjunto de $n$ elementos. El número total de permutaciones es $P(n) = n!$ y el número de permutaciones válidas para un reparto de amigo invisible lo llamaremos $p(n)$ y tenemos que averiguar cuánto vale.</p>

<h4 id="loscasosfciles">Los casos fáciles</h4>

<p>Empezaremos con los casos fáciles. Por la simple cuenta de la vieja vemos cuántas permutaciones son válidas cuando:</p>

<ul>
<li>Caso $n = 1$. Entonces $P(1) = 1$ y, obviamente $p(1) = 0$ puesto que el único participante se debe regalar a sí mismo.</li>
<li>Caso $n = 2$. Entonces $P(2) = 2$ y $p(2) = 1$. A partir del conjunto {A, B} la única permutación válida es {B, A}.</li>
<li>Caso $n = 3$. Entonces $P(3) = 6$ y $p(3) = 2$; como se puede comprobar fácilmente, para el conjunto inicial {A, B, C} sólo son válidas las permutaciones {B, C, A} y {C, A, B}.</li>
</ul>

<p>A partir de aquí ya hay que empezar a razonar. Pasamos a los casos no triviales</p>

<h4 id="con4elementos">Con 4 elementos</h4>

<p>El caso con cuatro elementos &mdash;como el caso con el que hemos ejemplificado al principio&mdash; se podría resolver por medio de fuerza bruta; al fin y al cabo se trata de $4! = 24$ permutaciones que se pueden analizar a ojo sin demasiado esfuerzo. Pero vamos a proceder de forma sistemática.</p>

<p>La forma más sencilla que he encontrado es calcular el número de permutaciones en que <strong>hay al menos una coincidencia</strong>. Definimos $\pi(n)$ a ese número. Entonces:</p>

<p>$$    p(n) = P(n) - \pi(n) $$</p>

<p>Además, vamos a definir las permutaciones con coincidencia parcial. Así, $\pi_1(4)$ es el número de permutaciones de 4 elementos en el que uno &mdash;y sólo uno&mdash; de sus elementos coincide con la permutación de partida; $\pi_2(4)$, $\pi_3(4)$, $\pi_4(4)$ representan las permutaciones donde coinciden, respectivamente, 2, 3, y 4 elementos. De forma genérica:</p>  

<p>$$  
\pi(n) = \sum_{i=1}^{n} \pi_i(n)
$$</p>

<p>Para ver cuántas permutaciones tienen una única coincidencia supongamos que coincide el primer elemento. Entonces nos quedan 3 que <strong>no pueden coincidir</strong>; y ya sabemos que el número de permutaciones no coincidentes de 3 elementos es 2. Puesto que podemos fijar 4 elementos, tenemos un total de $4\times 2 = 8$ combinaciones en que coincide sólo un elemento. Es decir:  </p>

<p>$$  
\pi_1(4) = 4 \times p(3) = 8
$$</p>

<p>En el caso de permutaciones con sólo dos coincidencias, al fijar dos elementos nos quedan otros dos que <strong>no pueden coincidir</strong> y sólo hay 1 permutación válida para esos dos elementos. Pero ahora el número de parejas coincidentes las debemos repartir entre 4 elementos. Y esto no es más que el número de <a href="http://es.wikipedia.org/wiki/Combinaciones">combinaciones</a> de 4 elementos tomados de 2 en 2:  </p>

<p>$$  
\binom{4}{2} = \frac{4 \times 3}{2} = 6
$$</p>

<p>Por tanto,  </p>

<p>$$  
\pi_2(4) = \binom{4}{2} p(2) = 6
$$</p>

<p>Las permutaciones con 3 coincidencias son fáciles de calcular puesto que no hay ninguna: recordemos que al fijar 3 elementos el elemento que queda tiene necesariamente que coincidir:  </p>

<p>$$  
\pi_3(4) = \binom{4}{3} p(1) = 0
$$</p>

<p>Y, finalmente, sólo hay una permutación con todos los elementos coincidentes: $\pi_4(4) = 1$. En general es inmediato ver que $\pi_n(n) = 1$. Por tanto,</p>  

<p>$$  
\pi(4) = 8 + 6 + 0 + 1 = 15
$$</p>

<p>Y el número de permutaciones válidas para hacer un amigo invisible con cuatro elementos es nueve: <br />
$$
p(4) = P(4) - \pi(4) = 24 - 15 = 9 <br />
$$</p>

<p>Por desgracia, el método propuesto no es constructivo y no proporciona cuáles son esas 9 permutaciones. Las pongo aquí, en un aparte:</p>

<p><code>{B, C, D, A}</code>, <code>{C, D, A, B}</code>, <code>{D, A, B, C}</code>, <code>{B, A, D, C}</code>, <code>{C, D, B, A}</code>, <code>{D, C, B, A}</code>, <code>{C, A, D, B}</code>, <code>{B, D, A, C}</code>, <code>{D, C, A, B}</code></p>

<h4 id="mtodogeneral">Método general</h4>

<p>A partir de lo visto en el caso de cuatro elementos, vemos que podemos generalizar el cálculo de $\pi(n)$ para $n > 2$:  </p>

<p>$$  
\pi(n) = 1 + \sum_{i=1}^{n-2} \binom{n}{i} p(n-i)
$$</p>

<p>o, en términos de $p(n)$  </p>

<p>$$  
p(n) = n! - 1 - \sum_{i=1}^{n-2} \binom{n}{i} p(n-i)  
$$</p>

<p>Vemos que es necesario calcular secuencialmente los distintos $p(n)$ puesto que es necesario recurrir a los anteriores. Por ejemplo, vamos a calcular el caso $n=5$: <br />
$$
p(5) = 120 - 1 -\left(45 + 20 + 10 \right) = 44 <br />
$$</p>

<h3 id="unasorpresa">Una sorpresa...</h3>

<p>Obviamente, $p(n)$ es siempre inferior a $P(n)$. Por lo visto en los cálculos anteriores da la impresión de que hay un factor de proporcionalidad entre ambos. Veámoslo en la siguiente tabla en la que hemos añadido también el caso $n=6$:  </p>

<p>$$  
\begin{array}{c|rrc}
n & P(n) & p(n) & P(n)/p(n) \\  
\hline
2 & 2 & 1 & 2.000 \\  
3 & 6 & 2 & 3.000 \\  
4 & 24 & 9 & 2.667 \\  
5 & 120 & 44 & 2.727 \\  
6 & 720 & 265 & 2.720  
\end{array}
$$</p>

<p>¿No resulta familiar el número al que parece que convergen los cocientes? ¡Pues sí, es el famoso número $e$! la base de los logaritmos naturales de valor $e = 2.71828...$ De hecho, podemos proponer la siguiente fórmula (sin prueba formal) para $p(n)$ sin necesidad de calcular los $n-1$ términos previos:
$$
p(n) = \lfloor n!/e + 0.5 \rfloor <br />
$$</p>

<p>fórmula que se cumple rigurosamente para todos los casos de la tabla anterior. Podemos ahora predecir el término $n=7$: <br />
$$
7!/e = 5040/2.71828... \simeq 1854.11 <br />
$$</p>

<p>Luego $p(7) = 1854$. Invito a la lectora (o lector) a comprobar este resultado con la fórmula original.</p>

<p>Desde el punto de vista práctico, si generamos de alguna forma una permutación aleatoria, la probabilidad de que esa permutación nos permita un amigo invisible válido es de $1/e$ o, aproximadamente, un 37%.</p>

<p>A mi me resulta bastante curioso que, investigando cómo organizar un intercambio de regalos por medio del amigo invisible ¡acabemos llegando al número $e$!</p>

<p>Cosas veredes...</p>
                    </div>
                    <h3>Sobre el autor</h3>
                    <div class="at_author">
                        <div class="row">
                            <div class="medium-2 columns show-for-medium-up">
                                <div class="at_author_image">
                                    <img src="../content/images/2013/Dec/retrato_manolo_cuadrado_200.jpg" alt="Shevek">
                                </div>
                            </div>
                            <div class="medium-10 columns">
                                <div class="at_author_name">
                                    <h3>Shevek</h3>
                                </div>
                                <div class="at_author_bio">
                                    <p>Ciudadano libertario. Usuario de software libre y programador ocasional. Físico, músico, amante de las matemáticas, la fotografía, la criptografía y el lenguaje. Vivo sin dios ni televisión.

</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="at_post_comments">
                        
                    </div>
                </article>
            </div>
            
        </div>
    </div>
</div>



<div id="at_footer">
	<div class="row">
		<div class="large-12 columns text-center">
			<div class="at_block">
				<div class="copyright">
					<span>&copy; 2014 <a href="http://esquelario.tk/">Esquelario</a> - Contenidos liberados al <a href="http://esquelario.tk/licencia">dominio público.</a></span>
				</div>
				<div class="poweredby">
					<span>Blog gestionado con <a href="http://ghost.org"><i class="icon-ghost"></i> Ghost</a>. Tema basado en <a href="https://github.com/axiantheme/ghostion/">Ghostion</a></span>
				</div>
			</div>
		</div>
	</div>
</div>


        </div>
    </div>

    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../assets/js/jquery-2.1.0.min.js?v=4589256930"><\/script>')</script>

    <script>
        /*** CONFIGURATION VARIABLES: EDIT THE VALUES BELOW FOR THEME CONFIGURATION ***/
        var ghostionConfig = {
            site_url:                       "esquelario.tk",
            google_fonts_family:            "",
            google_analytics_tracking_id:   "",
            disqus_shortname:               ""
        };
    </script>
    <script src="../assets/js/ghostion.min.js?v=4589256930"></script>
</body>
</html>
